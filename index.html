<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Finance Pulse</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
</head>
<body class="bg-gray-900 text-white font-sans">
  <div class="max-w-4xl mx-auto p-4">
    <h1 class="text-3xl font-bold mb-4">ðŸ“Š Finance Pulse</h1>

    <!-- Market Alerts -->
    <section id="alerts" class="mb-6">
      <h2 class="text-xl font-semibold mb-2">Market Pulse Alerts</h2>
      <div class="grid grid-cols-2 gap-4" id="alert-cards"></div>
    </section>

    <!-- News Headlines -->
    <section class="mb-6">
      <h2 class="text-xl font-semibold mb-2">Latest Market Headlines</h2>
      <ul id="news-list" class="list-disc list-inside text-sm space-y-1"></ul>
    </section>

    <!-- Investment Mode Suggestion -->
    <section class="mb-6">
      <h2 class="text-xl font-semibold mb-2">Investment Mode</h2>
      <div id="mode-box" class="p-4 rounded-lg font-bold text-lg text-center bg-yellow-500 text-black">Loading...</div>
    </section>
  </div>

<script>
const MA_TOKEN = 'oVD1aAOfz57uhiKUUYS3DWw3RFFWQjjpOHLOAkzl';
const indicators = [
  { name: 'S&P 500', symbol: 'SPY' },
  { name: 'NASDAQ-100', symbol: 'QQQ' },
  { name: 'Gold', symbol: 'XAUUSD' },
  { name: '10Y Treasury', symbol: 'IEF' },
  { name: 'Oil', symbol: 'CL=F' },
  { name: 'Fear & Greed', symbol: 'FGI' }
];

async function fetchPrice(symbol) {
  if (symbol === 'FGI') return fetchFearGreed();

  const url = `https://financialmodelingprep.com/api/v3/quote/${symbol}?apikey=wBaK2cIhxa1C7tg5D3NpSu9CduOCbvgF`;
  try {
    const res = await fetch(url);
    const data = await res.json();
    if (data && data[0]) {
      return {
        price: parseFloat(data[0].price),
        change: parseFloat(data[0].changesPercentage)
      };
    } else {
      throw new Error('No data');
    }
  } catch (err) {
    console.error(`Error fetching ${symbol}:`, err);
    return { price: 'N/A', change: 'N/A' };
  }
}

async function fetchFearGreed() {
  try {
    const res = await fetch('https://api.alternative.me/fng/?limit=1');
    const json = await res.json();
    const value = parseInt(json.data[0].value);
    return { price: value, change: null };
  } catch (err) {
    console.error('Error fetching Fear & Greed Index:', err);
    return { price: 'N/A', change: null };
  }
}

function determineRisk(item) {
  const { name, price } = item;
  if (name === 'S&P 500' && price < 430) return 'risk-off';
  if (name === 'NASDAQ-100' && price < 350) return 'risk-off';
  if (name === '10Y Treasury' && price < 90) return 'risk-off';
  if (name === 'Gold' && price > 2300) return 'risk-off';
  if (name === 'Fear & Greed' && price < 30) return 'risk-off';
  return 'neutral';
}

function renderIndicators(data) {
  const container = document.getElementById('alert-cards');
  container.innerHTML = '';
  data.forEach(d => {
    const risk = determineRisk(d);
    const bg = risk === 'risk-off' ? 'bg-red-500' : 'bg-green-500';
    container.innerHTML += `
      <div class="p-4 rounded-lg ${bg} text-black">
        <div class="text-sm font-bold">${d.name}</div>
        <div class="text-xl">${d.price === 'N/A' ? 'N/A' : `$${d.price.toLocaleString()}`}</div>
        ${d.change !== null && d.change !== 'N/A' ? `<div class="text-sm">${d.change.toFixed(2)}%</div>` : ''}
      </div>
    `;
  });

  const riskOffCount = data.filter(d => determineRisk(d) === 'risk-off').length;
  const modeBox = document.getElementById('mode-box');
  if (riskOffCount >= 3) {
    modeBox.textContent = 'âš ï¸ High Risk: Consider Defensive Strategy';
    modeBox.className = 'p-4 rounded-lg font-bold text-lg text-center bg-red-500 text-black';
  } else if (riskOffCount === 0) {
    modeBox.textContent = 'âœ… Market Stable: Growth Mode On';
    modeBox.className = 'p-4 rounded-lg font-bold text-lg text-center bg-green-500 text-black';
  } else {
    modeBox.textContent = 'ðŸŸ¡ Mixed Signals: Monitor Closely';
    modeBox.className = 'p-4 rounded-lg font-bold text-lg text-center bg-yellow-500 text-black';
  }
}

function getYesterdayISO() {
  const d = new Date();
  d.setDate(d.getDate() - 1);
  return d.toISOString();
}

async function loadNews() {
  try {
    const res = await fetch(`https://api.marketaux.com/v1/news/all?api_token=${MA_TOKEN}&limit=10&language=en&published_after=${getYesterdayISO()}`);
    const json = await res.json();
    const news = json.data.filter(n => n.title && n.url).slice(0, 6);
    renderNews(news);
  } catch (err) {
    console.error('News fetch error:', err);
  }
}

function renderNews(articles) {
  const list = document.getElementById('news-list');
  list.innerHTML = '';
  articles.forEach(article => {
    const li = document.createElement('li');
    li.classList.add('mb-1');
    li.innerHTML = `<a href="${article.url}" class="underline hover:text-yellow-300" target="_blank">${article.title}</a>`;
    list.appendChild(li);
  });
}

async function initDashboard() {
  const data = [];
  for (const indicator of indicators) {
    const result = await fetchPrice(indicator.symbol);
    data.push({ ...indicator, ...result });
  }
  renderIndicators(data);
  loadNews();
}

initDashboard();
</script>
</body>
</html>
