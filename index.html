<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Finance Pulse</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" />
</head>
<body class="bg-gray-900 text-white font-sans">
  <div class="max-w-4xl mx-auto p-4">
    <h1 class="text-3xl font-bold mb-4">üìä Finance Pulse</h1>

    <!-- Market Alerts -->
    <section id="alerts" class="mb-6">
      <h2 class="text-xl font-semibold mb-2">Market Pulse Alerts</h2>
      <div class="grid grid-cols-2 gap-4" id="alert-cards"></div>
    </section>

    <!-- News Headlines -->
    <section class="mb-6">
      <h2 class="text-xl font-semibold mb-2">Latest Market Headlines</h2>
      <ul id="news-list" class="list-disc list-inside text-sm space-y-1"></ul>
    </section>

    <!-- Macro Snapshot -->
    <section class="mb-6">
      <h2 class="text-xl font-semibold mb-2">Macro Snapshot</h2>
      <div id="macro-panel" class="grid grid-cols-2 gap-4 text-sm"></div>
    </section>

    <!-- Mode Suggestion -->
    <section class="mb-6">
      <h2 class="text-xl font-semibold mb-2">Investment Mode</h2>
      <div id="mode-box" class="p-4 rounded-lg font-bold text-lg text-center bg-yellow-500 text-black">Loading...</div>
    </section>
  </div>

  <script>
    const TWELVE_API_KEY = '146a9495d2c64e85936d21b0be82c103';   // ‚Üê Replace with your Twelve Data API key
    const FINNHUB_API_KEY = 'd1482k1r01qrqeasm27gd1482k1r01qrqeasm280';       // ‚Üê Replace with your Finnhub API key

    // Expanded symbol list
    const symbols = [
      { name: 'S&P 500', symbol: 'SPY', type: 'etf' },
      { name: 'VIX', symbol: 'VIX', type: 'index' },
      { name: 'Bitcoin', symbol: 'BTCUSD', type: 'crypto' },
      { name: 'Gold', symbol: 'XAU/USD', type: 'commodity' },
      { name: 'US 10Y Yield', symbol: 'US10Y', type: 'bond' },
      { name: 'Nasdaq', symbol: 'QQQ', type: 'etf' },
    ];

    async function fetchPrices() {
      const base = 'https://api.twelvedata.com/price';
      const data = [];

      for (const s of symbols) {
        const url = `${base}?symbol=${encodeURIComponent(s.symbol)}&apikey=${TWELVE_API_KEY}`;
        try {
          const res = await fetch(url);
          const json = await res.json();

          if (json.price) {
            data.push({ ...s, value: parseFloat(json.price) });
          } else {
            console.warn(`No price data for ${s.symbol}:`, json);
            data.push({ ...s, value: NaN });
          }
        } catch (err) {
          console.error(`Error fetching ${s.symbol}:`, err);
          data.push({ ...s, value: NaN });
        }
      }

      return data;
    }

    // Adjusted risk rules for 6 items
    function determineRiskType(name, value) {
      if (isNaN(value)) return 'neutral';  // No data fallback

      switch (name) {
        case 'S&P 500':
        case 'Nasdaq':
          if (value < 430) return 'risk-off';
          return 'neutral';

        case 'VIX':
          if (value > 20) return 'risk-off';
          return 'neutral';

        case 'Bitcoin':
          if (value < 30000) return 'risk-off';
          return 'neutral';

        case 'Gold':
          // Gold often rises in risk-off, so high price might signal risk-off
          if (value > 1800) return 'risk-off';
          return 'neutral';

        case 'US 10Y Yield':
          // Rising yield may imply risk-on, falling yield risk-off
          // This is a simplified rule
          if (value < 3.0) return 'risk-off';
          return 'neutral';

        default:
          return 'neutral';
      }
    }

    function renderLiveAlerts(data) {
      const container = document.getElementById('alert-cards');
      container.innerHTML = '';
      data.forEach(a => {
        const riskType = determineRiskType(a.name, a.value);
        const bg = riskType === 'risk-off' ? 'bg-red-500' :
                   riskType === 'risk-on' ? 'bg-green-500' : 'bg-yellow-500';
        container.innerHTML += `<div class="p-4 rounded-lg ${bg} text-black">
          <div class="text-sm font-bold">${a.name}</div>
          <div class="text-xl">${isNaN(a.value) ? 'N/A' : a.value.toLocaleString()}</div>
        </div>`;
      });

      renderModeSuggestion(data);
    }

    function renderModeSuggestion(alerts) {
      const modeBox = document.getElementById('mode-box');
      const riskOffCount = alerts.filter(a => determineRiskType(a.name, a.value) === 'risk-off').length;

      if (riskOffCount >= 3) {
        modeBox.textContent = '‚ö†Ô∏è High Caution: Consider Holding Cash or Rebalancing';
        modeBox.className = 'p-4 rounded-lg font-bold text-lg text-center bg-red-600 text-black';
      } else if (riskOffCount === 0) {
        modeBox.textContent = '‚úÖ Market Stable: Stay Invested';
        modeBox.className = 'p-4 rounded-lg font-bold text-lg text-center bg-green-600 text-black';
      } else {
        modeBox.textContent = 'üü° Moderate Risk: Stay Informed and Watch Closely';
        modeBox.className = 'p-4 rounded-lg font-bold text-lg text-center bg-yellow-500 text-black';
      }
    }

    async function fetchNews() {
      const url = `https://finnhub.io/api/v1/news?category=general&token=${FINNHUB_API_KEY}`;
      try {
        const res = await fetch(url);
        const articles = await res.json();
        return articles.slice(0, 5);
      } catch (err) {
        console.error('News fetch error:', err);
        return [];
      }
    }

    function renderNewsHeadlines(articles) {
      const list = document.getElementById('news-list');
      list.innerHTML = '';
      articles.forEach(article => {
        const li = document.createElement('li');
        li.classList.add('mb-1');
        li.innerHTML = `
          <a href="${article.url}" class="underline hover:text-yellow-300" target="_blank" rel="noopener noreferrer">
            ${article.headline}
          </a>`;
        list.appendChild(li);
      });
    }

    function renderMacroSnapshot() {
      const macroPanel = document.getElementById('macro-panel');
      // Static example data for now ‚Äî replace with real API calls later if you want
      const macroData = {
        'Inflation Rate': '5.4%',
        'Fed Funds Rate': '5.00%',
        'GDP Growth': '2.1%',
        'Unemployment Rate': '3.7%'
      };

      macroPanel.innerHTML = '';
      for (const [key, val] of Object.entries(macroData)) {
        macroPanel.innerHTML += `
          <div class="p-3 bg-gray-800 rounded shadow">
            <div class="font-semibold">${key}</div>
            <div>${val}</div>
          </div>
        `;
      }
    }

    async function initDashboard() {
      const priceData = await fetchPrices();
      renderLiveAlerts(priceData);

      const newsArticles = await fetchNews();
      renderNewsHeadlines(newsArticles);

      renderMacroSnapshot();
    }

    initDashboard();
  </script>
</body>
</html>
