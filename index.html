<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Finance Pulse</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-900 text-white font-sans">
  <div class="max-w-4xl mx-auto p-4">
    <h1 class="text-3xl font-bold mb-4">üìä Finance Pulse</h1>

    <!-- Market Alerts -->
    <section id="alerts" class="mb-6">
      <h2 class="text-xl font-semibold mb-2">Market Pulse Alerts</h2>
      <div class="grid grid-cols-2 md:grid-cols-3 gap-4" id="alert-cards"></div>
    </section>

    <!-- News Headlines -->
    <section class="mb-6">
      <h2 class="text-xl font-semibold mb-2">Latest Market Headlines</h2>
      <ul id="news-list" class="list-disc list-inside text-sm space-y-1"></ul>
    </section>

    <!-- Investment Mode -->
    <section class="mb-6">
      <h2 class="text-xl font-semibold mb-2">Investment Mode</h2>
      <div id="mode-box" class="p-4 rounded-lg font-bold text-lg text-center bg-yellow-500 text-black">Loading...</div>
    </section>
  </div>

<script>
const FMP_API_KEY = 'wBaK2cIhxa1C7tg5D3NpSu9CduOCbvgF'; // Replace with your actual FMP key

const indicators = [
  { name: 'S&P 500', symbol: 'SPY', source: 'fmp' },
  { name: 'Nasdaq 100', symbol: 'QQQ', source: 'fmp' },
  { name: 'US 10Y Bond (IEF)', symbol: 'IEF', source: 'fmp' },
  { name: 'Gold', symbol: 'XAUUSD', source: 'fmp' },
  { name: 'Dollar Index', symbol: 'DXY', source: 'fmp' },
  { name: 'Bitcoin', symbol: 'bitcoin', source: 'coingecko' },
];

// Fetch from FMP
async function fetchFMPQuote(symbol) {
  const url = `https://financialmodelingprep.com/api/v3/quote/${symbol}?apikey=${FMP_API_KEY}`;
  try {
    const res = await fetch(url);
    const json = await res.json();
    if (json.length) {
      return {
        price: json[0].price,
        change: json[0].changesPercentage,
      };
    }
  } catch (err) {
    console.error(`FMP fetch failed for ${symbol}:`, err);
  }
  return null;
}

// Fetch from CoinGecko
async function fetchCoinGeckoPrice() {
  const url = 'https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd&include_24hr_change=true';
  try {
    const res = await fetch(url);
    const json = await res.json();
    return {
      price: json.bitcoin.usd,
      change: json.bitcoin.usd_24h_change,
    };
  } catch (err) {
    console.error('CoinGecko fetch failed:', err);
    return null;
  }
}

async function fetchAllData() {
  const results = [];
  for (const item of indicators) {
    let result = null;
    if (item.source === 'fmp') {
      result = await fetchFMPQuote(item.symbol);
    } else if (item.source === 'coingecko') {
      result = await fetchCoinGeckoPrice();
    }

    results.push({
      name: item.name,
      price: result?.price ?? 'N/A',
      change: result?.change ?? 'N/A',
    });
  }
  return results;
}

function renderAlerts(data) {
  const container = document.getElementById('alert-cards');
  container.innerHTML = '';
  data.forEach(item => {
    const isDown = typeof item.change === 'number' && item.change < 0;
    const bgColor = isDown ? 'bg-red-500' : 'bg-green-500';
    container.innerHTML += `
      <div class="p-4 rounded-lg ${bgColor} text-black">
        <div class="text-sm font-bold">${item.name}</div>
        <div class="text-xl">${typeof item.price === 'number' ? item.price.toFixed(2) : 'N/A'}</div>
        <div class="text-sm">${typeof item.change === 'number' ? item.change.toFixed(2) + '%' : ''}</div>
      </div>
    `;
  });

  renderMode(data);
}

function renderMode(data) {
  const modeBox = document.getElementById('mode-box');
  const dropCount = data.filter(d => typeof d.change === 'number' && d.change < -0.5).length;

  if (dropCount >= 4) {
    modeBox.textContent = '‚ö†Ô∏è High Risk: Consider Holding Cash or Rebalancing';
    modeBox.className = 'p-4 rounded-lg font-bold text-lg text-center bg-red-500 text-black';
  } else if (dropCount <= 1) {
    modeBox.textContent = '‚úÖ Market Stable: Stay Invested';
    modeBox.className = 'p-4 rounded-lg font-bold text-lg text-center bg-green-500 text-black';
  } else {
    modeBox.textContent = 'üü° Mixed Signals: Monitor Closely';
    modeBox.className = 'p-4 rounded-lg font-bold text-lg text-center bg-yellow-500 text-black';
  }
}

// News Section
async function fetchNews() {
  const url = 'https://finnhub.io/api/v1/news?category=general&token=d1482k1r01qrqeasm27gd1482k1r01qrqeasm280'; // Replace with your own if needed
  try {
    const res = await fetch(url);
    const articles = await res.json();
    return articles.slice(0, 5);
  } catch (err) {
    console.error('News fetch error:', err);
    return [];
  }
}

function renderNews(articles) {
  const list = document.getElementById('news-list');
  list.innerHTML = '';
  articles.forEach(article => {
    const li = document.createElement('li');
    li.innerHTML = `<a href="${article.url}" class="underline hover:text-yellow-300" target="_blank">${article.headline}</a>`;
    list.appendChild(li);
  });
}

// Main Init
(async function init() {
  const data = await fetchAllData();
  renderAlerts(data);

  const news = await fetchNews();
  renderNews(news);
})();
</script>

</body>
</html>
