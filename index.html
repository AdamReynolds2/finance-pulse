<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Finance Pulse</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-900 text-white font-sans">
  <div class="max-w-4xl mx-auto p-4">
    <h1 class="text-3xl font-bold mb-4">ğŸ“Š Finance Pulse</h1>
    <section class="mb-6">
      <h2 class="text-xl font-semibold mb-2">Market Pulse Alerts</h2>
      <div class="grid grid-cols-2 md:grid-cols-3 gap-4" id="alert-cards"></div>
    </section>
    <section class="mb-6">
      <h2 class="text-xl font-semibold mb-2">Latest Market Headlines</h2>
      <ul id="news-list" class="list-disc list-inside text-sm space-y-1"></ul>
    </section>
    <section class="mb-6">
      <h2 class="text-xl font-semibold mb-2">Investment Mode</h2>
      <div id="mode-box" class="p-4 rounded-lg font-bold text-lg text-center bg-yellow-500 text-black">Loading...</div>
    </section>
  </div>

<script>
const FMP_API_KEY = 'wBaK2cIhxa1C7tg5D3NpSu9CduOCbvgF';

const indicators = [
  { name: 'S&P 500', symbol: 'SPY', source: 'fmp' },
  { name: 'Nasdaq 100', symbol: 'QQQ', source: 'fmp' },
  { name: 'US 10Y Bond (IEF)', symbol: 'IEF', source: 'fmp' },
  { name: 'Gold', symbol: 'XAUUSD', source: 'fmp' },
  { name: 'Dollar (UUP)', symbol: 'UUP', source: 'fmp' },
  { name: 'Crypto Fear & Greed', symbol: 'fng', source: 'fng' },
];

// Fetch from FMP
async function fetchFMP(symbol) {
  const url = `https://financialmodelingprep.com/api/v3/quote/${symbol}?apikey=${FMP_API_KEY}`;
  try {
    const res = await fetch(url);
    const j = await res.json();
    if (j.length) return { price: j[0].price, change: j[0].changesPercentage };
  } catch (e) {console.error('FMP error', e);}
  return null;
}

// Fetch Fear & Greed
async function fetchFNG() {
  try {
    const res = await fetch('https://api.alternative.me/fng/?limit=1');
    const j = await res.json();
    const d = j.data[0];
    return { price: parseInt(d.value), change: null, sentiment: d.value_classification };
  } catch (e) {console.error('FNG error', e);}
  return null;
}

async function loadAll() {
  const out = [];
  for (let ind of indicators) {
    let r = null;
    if (ind.source === 'fmp') r = await fetchFMP(ind.symbol);
    else if (ind.source === 'fng') r = await fetchFNG();
    out.push({ name: ind.name, price: r?.price ?? 'N/A', change: r?.change ?? 'N/A', sentiment: r?.sentiment });
  }
  return out;
}

function render(cards) {
  const c = document.getElementById('alert-cards');
  c.innerHTML = '';
  cards.forEach(i => {
    const isDrop = typeof i.change === 'number' && i.change < 0;
    const isFear = i.sentiment && i.sentiment.toLowerCase().includes('fear');
    const bg = i.name === 'Crypto Fear & Greed'
      ? (isFear ? 'bg-red-500' : 'bg-green-500')
      : (isDrop ? 'bg-red-500' : 'bg-green-500');

    let line2 = typeof i.price==='number'?i.price.toFixed(2):i.price;
    let line3 = i.name==='Crypto Fear & Greed' ? i.sentiment : (typeof i.change==='number' ? i.change.toFixed(2)+'%' : '');

    c.innerHTML += `<div class="p-4 rounded-lg ${bg} text-black"><div class="font-bold">${i.name}</div><div class="text-xl">${line2}</div><div class="text-sm">${line3}</div></div>`;
  });

  renderMode(cards);
}

function renderMode(cards) {
  const mb = document.getElementById('mode-box');
  const drops = cards.filter(i => (typeof i.change==='number'&&i.change< -0.5) || (i.name==='Crypto Fear & Greed' && i.sentiment.toLowerCase().includes('fear'))).length;

  if (drops >= 4) {
    mb.textContent = 'âš ï¸ High Risk';
    mb.className = 'p-4 rounded-lg bg-red-500 text-white';
  } else if (drops <= 1) {
    mb.textContent = 'âœ… Stable';
    mb.className = 'p-4 rounded-lg bg-green-500 text-white';
  } else {
    mb.textContent = 'ğŸŸ¡ Mixed Signals';
    mb.className = 'p-4 rounded-lg bg-yellow-500 text-black';
  }
}

async function fetchNews() {
  try {
    const r = await fetch('https://finnhub.io/api/v1/news?category=general&token=YOUR_FINNHUB_KEY');
    return (await r.json()).slice(0,5);
  } catch(e){console.error('News error',e); return [];}
}

function renderNews(ns) {
  const ul = document.getElementById('news-list');
  ul.innerHTML = '';
  ns.forEach(a => {
    const li = document.createElement('li');
    li.innerHTML = `<a href="${a.url}" target="_blank" class="underline hover:text-yellow-300">${a.headline}</a>`;
    ul.appendChild(li);
  });
}

(async function init() {
  const data = await loadAll();
  render(data);
  const news = await fetchNews();
  renderNews(news);
})();
</script>
</body></html>
