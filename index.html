<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Finance Pulse</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-900 text-white">
  <div class="max-w-4xl mx-auto p-4">
    <h1 class="text-3xl font-bold mb-1">📊 Finance Pulse</h1>
    <div id="timestamp" class="text-sm text-gray-400 mb-4"></div>

    <!-- Alerts Section -->
    <section class="mb-6">
      <h2 class="text-xl font-semibold mb-2">Market Pulse Alerts</h2>
      <div id="alerts" class="grid grid-cols-2 gap-4"></div>
    </section>

    <!-- Sentiment Indicator -->
    <section class="mb-6">
      <h2 class="text-xl font-semibold mb-2">Market Sentiment</h2>
      <div id="sentiment" class="p-4 bg-yellow-500 text-black rounded-lg font-bold text-lg">Loading...</div>
    </section>

    <!-- Headlines Section -->
    <section class="mb-6">
      <h2 class="text-xl font-semibold mb-2">Latest Market Headlines</h2>
      <ul id="headlines" class="list-disc list-inside space-y-2 text-sm"></ul>
    </section>

    <!-- Investment Mode Section -->
    <section class="mb-6">
      <h2 class="text-xl font-semibold mb-2">Suggested Investment Mode</h2>
      <div id="investment-mode" class="p-4 text-center font-bold text-lg rounded-lg bg-yellow-500 text-black">Loading...</div>
    </section>
  </div>

  <!-- Modal -->
  <div id="modal" class="fixed inset-0 bg-black bg-opacity-70 hidden flex items-center justify-center z-50">
    <div class="bg-white text-black rounded-xl p-6 max-w-xl w-full relative">
      <button onclick="closeModal()" class="absolute top-2 right-4 text-black font-bold text-xl">&times;</button>
      <canvas id="chart" class="w-full h-64"></canvas>
    </div>
  </div>

  <script>
    const indicators = [
      { symbol: 'SPY', name: 'S&P 500' },
      { symbol: 'QQQ', name: 'Nasdaq 100' },
      { symbol: 'IEF', name: '10Y Treasury ETF' },
      { symbol: 'XAUUSD', name: 'Gold' },
      { symbol: 'GLD', name: 'Gold ETF' },
      { symbol: 'AAPL', name: 'Apple' },
    ];

    const apiKey = 'wBaK2cIhxa1C7tg5D3NpSu9CduOCbvgF'; // Replace if needed
    let chartInstance = null;

    function updateTimestamp() {
      const now = new Date();
      document.getElementById('timestamp').textContent = `Last updated: ${now.toLocaleString()}`;
    }

    async function fetchPrice(symbol) {
      try {
        const res = await fetch(`https://financialmodelingprep.com/api/v3/quote/${symbol}?apikey=${apiKey}`);
        const data = await res.json();
        if (data.length === 0) throw new Error('No data');
        return data[0];
      } catch (err) {
        console.error(`Error fetching ${symbol}:`, err);
        return { symbol, price: 'N/A', changesPercentage: 'N/A' };
      }
    }

    async function fetchAllData() {
      updateTimestamp();

      const data = await Promise.all(indicators.map(i => fetchPrice(i.symbol)));
      const alertContainer = document.getElementById('alerts');
      alertContainer.innerHTML = '';

      let riskCount = 0;

      data.forEach(d => {
        const isRiskOff = d.changesPercentage !== 'N/A' && parseFloat(d.changesPercentage) < -1;
        if (isRiskOff) riskCount++;
        const bg = isRiskOff ? 'bg-red-500' : 'bg-green-500';
        const name = d.name || d.symbol;
        const priceText = d.price !== 'N/A' ? `$${parseFloat(d.price).toFixed(2)}` : 'N/A';
        const changeText = d.changesPercentage !== 'N/A' ? `${parseFloat(d.changesPercentage).toFixed(2)}%` : 'N/A';

        alertContainer.innerHTML += `
          <div class="${bg} p-4 rounded cursor-pointer" onclick="showChart('${d.symbol}', '${name}')">
            <div class="font-bold">${name}</div>
            <div>${priceText} (${changeText})</div>
          </div>`;
      });

      const modeBox = document.getElementById('investment-mode');
      if (riskCount >= 3) {
        modeBox.textContent = '⚠️ Risk-Off: Consider defensive positions';
        modeBox.className = 'p-4 text-center font-bold text-lg rounded-lg bg-red-500 text-black';
      } else if (riskCount === 0) {
        modeBox.textContent = '✅ Risk-On: Growth-friendly environment';
        modeBox.className = 'p-4 text-center font-bold text-lg rounded-lg bg-green-500 text-black';
      } else {
        modeBox.textContent = '🟡 Neutral: Stay informed';
        modeBox.className = 'p-4 text-center font-bold text-lg rounded-lg bg-yellow-500 text-black';
      }
    }

    async function fetchSentiment() {
      try {
        const res = await fetch('https://api.alternative.me/fng/?limit=1&format=json');
        const data = await res.json();
        const value = data.data[0];
        document.getElementById('sentiment').textContent = `${value.value_classification} (${value.value}/100)`;
      } catch (err) {
        console.error('Sentiment fetch error:', err);
        document.getElementById('sentiment').textContent = 'N/A';
      }
    }

    async function loadNews() {
  const fallbackHeadlines = [
    { title: "Stocks Edge Higher Ahead of Fed Comments", url: "https://www.marketwatch.com/" },
    { title: "Gold Steady as Dollar Slips on Soft Economic Data", url: "https://www.kitco.com/" },
    { title: "Treasury Yields Dip as Investors Eye Inflation Trends", url: "https://www.investing.com/" },
    { title: "Tech Giants Lead Nasdaq Recovery", url: "https://www.cnbc.com/" },
    { title: "Bitcoin Holds Ground Above $65K in Quiet Trading", url: "https://www.coindesk.com/" }
  ];

  try {
    const res = await fetch(`https://financialmodelingprep.com/api/v3/stock_news?tickers=SPY,QQQ,GLD,XAUUSD,BTCUSD,AAPL&limit=20&apikey=${apiKey}`);
    const headlines = await res.json();
    const list = document.getElementById('headlines');
    list.innerHTML = '';

    const items = Array.isArray(headlines) && headlines.length > 0 ? headlines.slice(0, 5) : fallbackHeadlines;

    items.forEach(item => {
      const li = document.createElement('li');
      const date = new Date(item.publishedDate).toLocaleDateString();
      li.innerHTML = `<a href="${item.url}" target="_blank" class="hover:text-yellow-300 underline">${item.title}</a><span class="text-gray-400 ml-2 text-xs">(${date})</span>`;
      list.appendChild(li);
    });
  } catch (err) {
    console.error('News fetch error:', err);
    const list = document.getElementById('headlines');
    list.innerHTML = '';
    fallbackHeadlines.forEach(item => {
      const li = document.createElement('li');
      li.innerHTML = `<a href="${item.url}" target="_blank" class="hover:text-yellow-300 underline">${item.title}</a>`;
      list.appendChild(li);
    });
  }
}



    async function showChart(symbol, name) {
      const res = await fetch(`https://financialmodelingprep.com/api/v3/historical-price-full/${symbol}?serietype=line&timeseries=30&apikey=${apiKey}`);
      const json = await res.json();
      const history = json.historical || [];

      const ctx = document.getElementById('chart').getContext('2d');
      if (chartInstance) chartInstance.destroy();

      chartInstance = new Chart(ctx, {
        type: 'line',
        data: {
          labels: history.map(d => d.date).reverse(),
          datasets: [{
            label: `${name} - Last 30 Days`,
            data: history.map(d => d.close).reverse(),
            fill: false,
            borderColor: '#3b82f6',
            tension: 0.1
          }]
        },
        options: {
          scales: {
            x: { ticks: { color: '#333' } },
            y: { ticks: { color: '#333' } }
          }
        }
      });

      document.getElementById('modal').classList.remove('hidden');
    }

    function closeModal() {
      document.getElementById('modal').classList.add('hidden');
    }

    async function initDashboard() {
      await fetchAllData();
      await fetchSentiment();
      await loadNews();
    }

    initDashboard();
  </script>
</body>
</html>
