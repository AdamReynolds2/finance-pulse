<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Finance Pulse</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-900 text-white">
  <div class="max-w-4xl mx-auto p-4">
    <h1 class="text-3xl font-bold mb-4">📊 Finance Pulse</h1>

    <!-- Alerts Section -->
    <section class="mb-6">
      <h2 class="text-xl font-semibold mb-2">Market Pulse Alerts</h2>
      <div id="alerts" class="grid grid-cols-2 gap-4"></div>
    </section>

    <!-- Sentiment Indicator -->
    <section class="mb-6">
      <h2 class="text-xl font-semibold mb-2">Market Sentiment</h2>
      <div id="sentiment" class="p-4 bg-yellow-500 text-black rounded-lg font-bold text-lg">Loading...</div>
    </section>

    <!-- Headlines Section -->
    <section class="mb-6">
      <h2 class="text-xl font-semibold mb-2">Latest Market Headlines</h2>
      <ul id="headlines" class="list-disc list-inside space-y-2 text-sm"></ul>
    </section>

    <!-- Investment Mode Section -->
    <section class="mb-6">
      <h2 class="text-xl font-semibold mb-2">Suggested Investment Mode</h2>
      <div id="investment-mode" class="p-4 text-center font-bold text-lg rounded-lg bg-yellow-500 text-black">Loading...</div>
    </section>
  </div>

  <script>
    const indicators = [
      { symbol: 'SPY', name: 'S&P 500' },
      { symbol: 'QQQ', name: 'Nasdaq 100' },
      { symbol: 'IEF', name: '10Y Treasury ETF' },
      { symbol: 'XAUUSD', name: 'Gold' },
      { symbol: 'GLD', name: 'Gold ETF' },
      { symbol: 'AAPL', name: 'Apple' },
    ];

    const apiKey = 'wBaK2cIhxa1C7tg5D3NpSu9CduOCbvgF'; // Replace with your FMP API key

    async function fetchPrice(symbol) {
      try {
        const res = await fetch(`https://financialmodelingprep.com/api/v3/quote/${symbol}?apikey=${apiKey}`);
        const data = await res.json();
        if (data.length === 0) throw new Error('No data');
        return data[0];
      } catch (err) {
        console.error(`Error fetching ${symbol}:`, err);
        return { symbol, price: 'N/A', changesPercentage: 'N/A' };
      }
    }

    async function fetchAllData() {
      const data = await Promise.all(indicators.map(i => fetchPrice(i.symbol)));
      const alertContainer = document.getElementById('alerts');
      alertContainer.innerHTML = '';

      let riskCount = 0;

      data.forEach(d => {
        const isRiskOff = d.changesPercentage !== 'N/A' && parseFloat(d.changesPercentage) < -1;
        if (isRiskOff) riskCount++;
        const bg = isRiskOff ? 'bg-red-500' : 'bg-green-500';
        alertContainer.innerHTML += `
          <div class="${bg} p-4 rounded">
            <div class="font-bold">${d.name || d.symbol}</div>
            <div>
              ${d.price !== 'N/A' ? `$${parseFloat(d.price).toFixed(2)}` : 'N/A'}
              (${d.changesPercentage !== 'N/A' ? `${parseFloat(d.changesPercentage).toFixed(2)}%` : 'N/A'})
            </div>
          </div>`;
      });

      // Set investment mode
      const modeBox = document.getElementById('investment-mode');
      if (riskCount >= 3) {
        modeBox.textContent = '⚠️ Risk-Off: Consider defensive positions';
        modeBox.className = 'p-4 text-center font-bold text-lg rounded-lg bg-red-500 text-black';
      } else if (riskCount === 0) {
        modeBox.textContent = '✅ Risk-On: Growth-friendly environment';
        modeBox.className = 'p-4 text-center font-bold text-lg rounded-lg bg-green-500 text-black';
      } else {
        modeBox.textContent = '🟡 Neutral: Stay informed';
        modeBox.className = 'p-4 text-center font-bold text-lg rounded-lg bg-yellow-500 text-black';
      }
    }

    async function fetchSentiment() {
      try {
        const res = await fetch('https://api.alternative.me/fng/?limit=1&format=json');
        const data = await res.json();
        const value = data.data[0];
        document.getElementById('sentiment').textContent = `${value.value_classification} (${value.value}/100)`;
      } catch (err) {
        console.error('Sentiment fetch error:', err);
        document.getElementById('sentiment').textContent = 'N/A';
      }
    }

    async function loadNews() {
      try {
        const res = await fetch('https://api.marketaux.com/v1/news/all?language=en&limit=6&api_token=demo');
        const json = await res.json();
        const headlines = json.data || [];
        const list = document.getElementById('headlines');
        list.innerHTML = '';
        headlines.slice(0, 6).forEach(item => {
          const li = document.createElement('li');
          li.innerHTML = `<a href="${item.url}" target="_blank" class="hover:text-yellow-300 underline">${item.title}</a>`;
          list.appendChild(li);
        });
      } catch (err) {
        console.error('News fetch error:', err);
      }
    }

    async function initDashboard() {
      await fetchAllData();
      await fetchSentiment();
      await loadNews();
    }

    initDashboard();
  </script>
</body>
</html>
